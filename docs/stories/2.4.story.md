# Story 2.4: City Search with Autocomplete

**Epic:** Epic 2 - Enhanced Forecast & Location Features  
**Story ID:** 2.4  
**Created:** 2025-12-03  
**Status:** Draft  

---

## Story

As a **user**,  
I want **to search for cities by name with autocomplete suggestions**,  
so that **I can quickly find and view weather for any location**.

---

## Acceptance Criteria

1. Search input component created with autocomplete functionality
2. OpenWeatherMap Geocoding API integrated for city search
3. As user types, suggestions appear (debounced to avoid excessive API calls)
4. Suggestions show city name, state/region, and country
5. Clicking a suggestion loads weather for that location
6. Search handles common variations (e.g., "NYC" â†’ "New York City")
7. Error handling for API failures and no results found
8. Search accessible via keyboard (arrow keys, Enter to select)
9. Search input clears after selection
10. Loading indicator shown while fetching suggestions
11. Minimum 3 characters required before triggering search
12. Debounce delay of 300ms to reduce API calls

---

## Tasks

### Task 1: Integrate Geocoding API
- Create `getCityCoordinates` service function
- Call `http://api.openweathermap.org/geo/1.0/direct?q={city}&limit=5`
- Validate response with Zod schema
- Handle errors (401, 404, 429, 500)
- Return array of city results with coordinates

### Task 2: Create CitySearch Component
- Build search input with autocomplete dropdown
- Implement debouncing (300ms delay)
- Minimum 3 characters before triggering search
- Display loading spinner while fetching
- Show suggestion list with city, state, country
- Handle keyboard navigation (up/down arrows, Enter, Escape)

### Task 3: Create AutocompleteDropdown Component
- Render list of city suggestions
- Each item shows: "City, State, Country"
- Highlight matched characters in search term
- Handle click and keyboard selection
- Close dropdown on selection or outside click
- Accessible with ARIA attributes

### Task 4: Add Search to Header/Navigation
- Position search prominently in app header
- Make accessible on all pages
- Ensure responsive design (full width on mobile)
- Add search icon for visual clarity

### Task 5: Handle Location Selection
- On city selection, get coordinates from result
- Update app state with new location
- Fetch weather data for new coordinates
- Update URL/routing if applicable
- Clear search input after selection

### Task 6: Create Tests
- Test geocoding API service function
- Test debouncing functionality
- Test autocomplete rendering
- Test keyboard navigation
- Test location selection flow
- Achieve 90%+ coverage

---

## Dev Notes

**Geocoding API:** `http://api.openweathermap.org/geo/1.0/direct?q={city}&limit=5&appid={API_KEY}`

**Debouncing:** Use `lodash.debounce` or custom hook with `setTimeout`

**State Management:** Use React Context or prop drilling for location state

**Accessibility:** Implement ARIA autocomplete pattern (combobox, listbox, option)

---

## Testing

Test API integration, debouncing, autocomplete rendering, keyboard navigation, and location selection.

**Coverage:** 90%+

---

## Change Log

| Date | Author | Change |
|------|--------|--------|
| 2025-12-03 | SM (Bob) | Story created from PRD Epic 2, Story 2.4 |

---

## Dev Agent Record

**Date Started:** _Pending_  
**Date Completed:** _Pending_  
**Agent:** _Pending_  

---

## QA Results

**Status:** _Pending_
