# Story 2.2: 5-Day Forecast Display Component

**Epic:** Epic 2 - Enhanced Forecast & Location Features  
**Story ID:** 2.2  
**Created:** 2025-12-03  
**Status:** Draft  

---

## Story

As a **user**,  
I want **to see a 5-day weather forecast with daily high/low temperatures and conditions**,  
so that **I can plan ahead for the coming week**.

---

## Acceptance Criteria

1. ForecastDisplay component created displaying 5 days of weather
2. Each day shows date, high/low temperatures, weather icon, and condition description
3. Component integrates with `useForecastQuery` hook from Story 2.1
4. Forecast processes 40 3-hour entries into 5 daily summaries using utility functions
5. Loading state displays skeleton for forecast cards
6. Error state displays helpful message with retry option
7. Component is fully responsive (horizontal scroll on mobile, grid on desktop)
8. Each forecast day card uses Tailwind glassmorphism styling
9. Icons use Lottie animations (from Story 1.5) or fallback to static icons
10. Precipitation probability displayed for each day if > 0%

---

## Tasks

### Task 1: Create ForecastDisplay Component Structure
**Acceptance Criteria:** AC1, AC7, AC8

**Subtasks:**
1. Create `src/components/weather/ForecastDisplay.tsx`
2. Define props: `{ lat: number, lon: number }`
3. Create responsive container: horizontal scroll on mobile (`overflow-x-auto`), grid on desktop
4. Use Tailwind classes: `flex md:grid md:grid-cols-5 gap-4`
5. Add glassmorphism container styling matching WeatherDisplay
6. Ensure horizontal scroll is smooth with touch (add `-webkit-overflow-scrolling: touch`)
7. Add padding/margin for proper spacing
8. Test responsiveness at 320px, 768px, 1024px breakpoints

### Task 2: Integrate useForecastQuery Hook
**Acceptance Criteria:** AC3

**Subtasks:**
1. Import `useForecastQuery` from `@/services/weather/hooks`
2. Call hook with `lat` and `lon` props
3. Destructure `{ data, isLoading, isError, error }` from query result
4. Handle undefined data state during initial load
5. Add type guards for safe data access

### Task 3: Process Forecast Data into Daily Summaries
**Acceptance Criteria:** AC4

**Subtasks:**
1. Import forecast utilities from `@/utils/forecastUtils`
2. Use `groupForecastByDay(data.list)` to group 40 entries into 5 days
3. For each day, calculate high/low temps with `getHighLowTemps(dayEntries)`
4. Determine primary weather condition with `getDailyCondition(dayEntries)`
5. Calculate max precipitation probability with `getDailyPrecipitation(dayEntries)`
6. Extract weather icon code from most representative entry
7. Create array of 5 daily summary objects for rendering
8. Handle edge case: fewer than 5 days of data (display what's available)

### Task 4: Create ForecastDayCard Component
**Acceptance Criteria:** AC2, AC8, AC9, AC10

**Subtasks:**
1. Create `src/components/weather/ForecastDayCard.tsx`
2. Accept props: `{ date: string, high: number, low: number, condition: string, iconCode: string, precipProbability: number }`
3. Display day of week (e.g., "Monday") from date
4. Show high/low temps: "75° / 60°" format
5. Render weather icon using `WeatherAnimation` component (Story 1.5)
6. Display condition description (e.g., "Partly Cloudy")
7. Show precipitation probability if > 0%: "60% chance of rain"
8. Apply glassmorphism card styling: `backdrop-blur-md bg-white/30 border border-white/20 rounded-xl p-4`
9. Add hover effect with Framer Motion (from Story 1.6)
10. Ensure card is minimum 120px width for touch targets

### Task 5: Implement Loading State
**Acceptance Criteria:** AC5

**Subtasks:**
1. Create `ForecastLoadingSkeleton` component
2. Render 5 skeleton cards matching ForecastDayCard layout
3. Use Tailwind `animate-pulse` or Framer Motion for animation
4. Include skeleton elements for date, temps, icon, condition
5. Match dimensions of actual forecast cards
6. Add accessibility label: `aria-label="Loading forecast"`

### Task 6: Implement Error State
**Acceptance Criteria:** AC6

**Subtasks:**
1. Create conditional rendering: `if (isError) return <ForecastError />`
2. Display user-friendly error message
3. Map API error codes to helpful messages (reuse pattern from Story 1.4)
4. Add retry button that refetches forecast query
5. Style error state with red accent
6. Ensure error is accessible with `role="alert"`

### Task 7: Add Responsive Design
**Acceptance Criteria:** AC7

**Subtasks:**
1. Mobile (< 768px): Horizontal scrollable row of cards
2. Use `snap-x snap-mandatory` for smooth scroll snapping
3. Each card: `snap-start flex-shrink-0 w-32`
4. Tablet/Desktop (>= 768px): CSS Grid with 5 columns
5. Ensure cards don't overflow container
6. Test touch scrolling on real mobile devices
7. Add scroll indicators (fade at edges) for better UX

### Task 8: Apply Animations with Framer Motion
**Acceptance Criteria:** AC8

**Subtasks:**
1. Wrap ForecastDayCard in `<motion.div>`
2. Add stagger animation when forecast loads
3. Use `staggerChildren` utility from Story 1.6
4. Add hover lift effect: `whileHover={{ y: -4 }}`
5. Animate card entrance with fade + slide
6. Respect reduced motion preferences

### Task 9: Integrate into HomePage
**Acceptance Criteria:** AC1-AC10 (integration)

**Subtasks:**
1. Import `ForecastDisplay` into `src/pages/HomePage.tsx`
2. Place below current weather display (WeatherDisplay component)
3. Pass same coordinates used for current weather
4. Add section heading: "5-Day Forecast"
5. Ensure proper spacing between current weather and forecast
6. Test full integration with real API data
7. Verify loading → success → error flows

### Task 10: Create Component Tests
**Acceptance Criteria:** AC1-AC10 (verification)

**Subtasks:**
1. Create `src/components/weather/ForecastDisplay.test.tsx`
2. Test: Renders 5 forecast day cards when data loaded
3. Test: Displays loading skeleton when `isLoading` is true
4. Test: Shows error message when `isError` is true
5. Test: Processes 40 forecast entries correctly into 5 daily summaries
6. Test: Each card displays high/low temps, condition, icon
7. Test: Precipitation probability shown if > 0%
8. Mock `useForecastQuery` hook for controlled testing
9. Test responsive classes applied correctly
10. Achieve 90%+ test coverage

---

## Dev Notes

### Architecture References

**Component Location:**  
`src/components/weather/ForecastDisplay.tsx` (Section 9: Source Tree Structure)

**Data Processing:**  
Use utility functions from `src/utils/forecastUtils.ts` (Story 2.1) to transform 40 3-hour entries into 5 daily summaries.

**Styling:**  
Match glassmorphism styling from `WeatherDisplay` component (Story 1.4). Use Tailwind utility classes for responsive design.

**Animations:**  
Leverage Framer Motion utilities from Story 1.6 for stagger animations and hover effects.

### Component Structure Example

```tsx
// src/components/weather/ForecastDisplay.tsx
import React from 'react';
import { useForecastQuery } from '@/services/weather/hooks';
import { groupForecastByDay, getHighLowTemps, getDailyCondition, getDailyPrecipitation } from '@/utils/forecastUtils';
import { ForecastDayCard } from './ForecastDayCard';
import { motion } from 'framer-motion';

interface ForecastDisplayProps {
  lat: number;
  lon: number;
}

export const ForecastDisplay: React.FC<ForecastDisplayProps> = ({ lat, lon }) => {
  const { data, isLoading, isError, error } = useForecastQuery({ lat, lon });

  if (isLoading) {
    return <ForecastLoadingSkeleton />;
  }

  if (isError) {
    return <ForecastError error={error} />;
  }

  const groupedByDay = groupForecastByDay(data.list);
  const dailySummaries = Object.entries(groupedByDay).slice(0, 5).map(([date, entries]) => ({
    date,
    ...getHighLowTemps(entries),
    condition: getDailyCondition(entries),
    iconCode: entries[0].weather[0].icon,
    precipProbability: getDailyPrecipitation(entries),
  }));

  return (
    <section className="mt-8">
      <h2 className="text-2xl font-bold mb-4">5-Day Forecast</h2>
      <div className="flex md:grid md:grid-cols-5 gap-4 overflow-x-auto snap-x snap-mandatory md:overflow-visible">
        {dailySummaries.map((day, index) => (
          <motion.div
            key={day.date}
            initial={{ opacity: 0, y: 20 }}
            animate={{ opacity: 1, y: 0 }}
            transition={{ delay: index * 0.1 }}
            className="snap-start flex-shrink-0 w-32 md:w-auto"
          >
            <ForecastDayCard {...day} />
          </motion.div>
        ))}
      </div>
    </section>
  );
};
```

### ForecastDayCard Example

```tsx
// src/components/weather/ForecastDayCard.tsx
import React from 'react';
import { motion } from 'framer-motion';
import { WeatherAnimation } from './WeatherAnimation';

interface ForecastDayCardProps {
  date: string;
  high: number;
  low: number;
  condition: string;
  iconCode: string;
  precipProbability: number;
}

export const ForecastDayCard: React.FC<ForecastDayCardProps> = ({
  date,
  high,
  low,
  condition,
  iconCode,
  precipProbability,
}) => {
  const dayOfWeek = new Date(date).toLocaleDateString('en-US', { weekday: 'short' });

  return (
    <motion.article
      className="backdrop-blur-md bg-white/30 border border-white/20 rounded-xl p-4 min-w-[120px]"
      whileHover={{ y: -4, transition: { duration: 0.2 } }}
    >
      <h3 className="text-lg font-semibold text-center">{dayOfWeek}</h3>
      <div className="flex justify-center my-2">
        <WeatherAnimation conditionCode={iconCode} size="sm" />
      </div>
      <p className="text-center text-sm font-medium capitalize">{condition}</p>
      <p className="text-center mt-2 font-bold">
        {Math.round(high)}° / {Math.round(low)}°
      </p>
      {precipProbability > 0 && (
        <p className="text-center text-xs text-blue-600 mt-1">
          {Math.round(precipProbability * 100)}% rain
        </p>
      )}
    </motion.article>
  );
};
```

### Testing Strategy

**Unit Tests:**
- Test ForecastDisplay processes data correctly
- Test ForecastDayCard renders all props correctly
- Test loading and error states
- Mock `useForecastQuery` hook

**Integration Tests:**
- Test full flow with real forecast data structure
- Verify utility functions transform data correctly
- Test responsive behavior at different breakpoints

**Coverage Target:** 90%+

---

## Testing

### Test Scenarios

1. **Daily Summaries:** Verify 40 entries processed into 5 daily summaries
2. **High/Low Temps:** Confirm correct high/low extraction from 3-hour entries
3. **Precipitation Display:** Verify precip probability shown only if > 0%
4. **Loading State:** Confirm skeleton displays during fetch
5. **Error State:** Verify error message and retry button
6. **Responsive Layout:** Test horizontal scroll on mobile, grid on desktop
7. **Animations:** Verify stagger animation and hover effects
8. **Integration:** Confirm component works in HomePage with real API

### Coverage Requirement
- **Target:** 90%+ line coverage
- **Tools:** Vitest + React Testing Library

---

## Change Log

| Date | Author | Change |
|------|--------|--------|
| 2025-12-03 | SM (Bob) | Story created from PRD Epic 2, Story 2.2 |

---

## Dev Agent Record

### Implementation Session

**Date Started:** _Pending_  
**Date Completed:** _Pending_  
**Agent:** _Pending_  
**Time Spent:** _Pending_  

**Notes:**  
_Implementation notes will be added by Dev Agent during execution._

---

## QA Results

**Tested By:** _Pending_  
**Test Date:** _Pending_  
**Status:** _Pending_  

**Test Results:**  
_QA validation results will be added after implementation._
