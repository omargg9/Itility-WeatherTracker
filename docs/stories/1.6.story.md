# Story 1.6: UI Polish & Framer Motion Enhancements

**Epic:** Epic 1 - Foundation & Core Weather Display  
**Story ID:** 1.6  
**Created:** 2025-12-03  
**Status:** Ready for Review  

---

## Story

As a **user**,  
I want **smooth page transitions and polished micro-interactions**,  
so that **the app feels premium and delightful to use**.

---

## Acceptance Criteria

1. Framer Motion library integrated (version 11.0.3)
2. Page transitions implemented between routes (fade, slide, or scale)
3. Micro-interactions added to interactive elements (buttons, cards, inputs)
4. Animations run at consistent 60fps without jank
5. Animations respect user's reduced motion preferences
6. Loading states use elegant transitions (not abrupt appearances)
7. Weather data updates animate smoothly (no jarring content replacement)
8. Touch/click feedback provided on all interactive elements
9. All animations use GPU-accelerated properties (transform, opacity)

---

## Tasks

### Task 1: Install and Configure Framer Motion
**Acceptance Criteria:** AC1

**Subtasks:**
1. Install `framer-motion@11.0.3`: `npm install framer-motion@11.0.3`
2. Verify installation in `package.json`
3. Import `motion` component in test file to confirm setup
4. Review Framer Motion documentation for best practices
5. Test basic motion component rendering
6. Configure TypeScript types (included in package)

### Task 2: Implement Page Transitions
**Acceptance Criteria:** AC2, AC4, AC5

**Subtasks:**
1. Create `PageTransition` wrapper component in `src/components/layout/PageTransition.tsx`
2. Define transition variants with Framer Motion:
   - `initial`: starting state (opacity 0, translateY 20px)
   - `animate`: final state (opacity 1, translateY 0px)
   - `exit`: exit state (opacity 0, translateY -20px)
3. Wrap page components in `<motion.div>` with variants
4. Configure transition timing: `transition={{ duration: 0.3, ease: 'easeOut' }}`
5. Use `AnimatePresence` in React Router to enable exit animations
6. Add `layoutId` for shared element transitions (if applicable)
7. Test transitions between HomePage, ForecastPage, FavoritesPage
8. Ensure transitions don't block navigation (use `mode="wait"` carefully)
9. Respect reduced motion: disable transitions when `prefers-reduced-motion: reduce`

### Task 3: Add Micro-Interactions to Buttons
**Acceptance Criteria:** AC3, AC8

**Subtasks:**
1. Create reusable `Button` component in `src/components/ui/Button.tsx`
2. Wrap button in `<motion.button>`
3. Add hover animation: `whileHover={{ scale: 1.05 }}`
4. Add tap/click animation: `whileTap={{ scale: 0.95 }}`
5. Add transition config: `transition={{ type: 'spring', stiffness: 400, damping: 17 }}`
6. Ensure touch targets are minimum 44x44px (iOS accessibility)
7. Add focus styles for keyboard navigation
8. Test on touch devices (iOS, Android) to verify tactile feedback
9. Apply to all buttons: search, retry, add to favorites, etc.

### Task 4: Add Card Hover Effects
**Acceptance Criteria:** AC3

**Subtasks:**
1. Wrap weather cards in `<motion.div>`
2. Add hover lift effect: `whileHover={{ y: -4, transition: { duration: 0.2 } }}`
3. Add subtle shadow increase on hover with Tailwind: `hover:shadow-2xl`
4. Add tap feedback: `whileTap={{ scale: 0.98 }}`
5. Test on forecast cards, favorites cards, and main weather display
6. Ensure animations work on both mouse and touch devices
7. Add `cursor: pointer` for clickable cards

### Task 5: Animate Loading States
**Acceptance Criteria:** AC6

**Subtasks:**
1. Update `LoadingSkeleton` component to use Framer Motion
2. Add fade-in animation when skeleton appears: `initial={{ opacity: 0 }} animate={{ opacity: 1 }}`
3. Add subtle pulse animation with custom keyframes
4. Replace Tailwind `animate-pulse` with Framer Motion for more control
5. Animate skeleton → content transition smoothly
6. Use `AnimatePresence` to fade out skeleton when data loads
7. Test transition from loading → success → error states
8. Ensure loading animations don't interfere with screen readers

### Task 6: Animate Weather Data Updates
**Acceptance Criteria:** AC7

**Subtasks:**
1. Add `AnimatePresence` around weather display content
2. Use `layout` prop on motion elements for automatic layout animations
3. Animate temperature changes: `animate={{ scale: [1, 1.1, 1] }}` when value updates
4. Add fade transition when weather condition changes
5. Use `key` prop to trigger animations on data updates: `key={data.dt}`
6. Configure exit animations for old data before new data appears
7. Add stagger effect if multiple elements update simultaneously
8. Test animations when switching locations or refreshing data
9. Ensure animations don't cause layout shift (CLS)

### Task 7: Add Input Field Animations
**Acceptance Criteria:** AC3

**Subtasks:**
1. Create `Input` component in `src/components/ui/Input.tsx` with Framer Motion
2. Add focus animation: border color change with transition
3. Add label float animation when input has value
4. Add error state animation: shake effect with `animate={{ x: [-10, 10, -10, 0] }}`
5. Add success state animation: subtle scale or checkmark appearance
6. Use `whileFocus` prop for focus interactions
7. Ensure animations work with React Hook Form (if used)
8. Test on search input and autocomplete components

### Task 8: Implement Gesture Animations (Mobile)
**Acceptance Criteria:** AC8

**Subtasks:**
1. Add swipe-to-delete gesture on favorites list items
2. Use `motion.div` with `drag` prop: `drag="x" dragConstraints={{ left: -100, right: 0 }}`
3. Add `onDragEnd` handler to detect swipe threshold (> 50px = delete)
4. Animate delete action: slide out with fade
5. Add visual feedback during drag (show delete icon)
6. Test on touch devices to ensure smooth gesture recognition
7. Add haptic feedback on mobile (if browser supports Vibration API)
8. Ensure gestures don't conflict with scroll behavior

### Task 9: Optimize Animation Performance
**Acceptance Criteria:** AC4, AC9

**Subtasks:**
1. Use GPU-accelerated properties only: `transform`, `opacity`
2. Avoid animating layout properties: `width`, `height`, `margin`, `padding`
3. Add `will-change: transform` CSS hint for complex animations
4. Use `layout` prop sparingly (can be expensive)
5. Measure performance with Chrome DevTools Performance panel
6. Ensure all animations run at 60fps on mid-range devices
7. Reduce animation complexity if performance drops below 60fps
8. Test on real mobile devices (iOS, Android) to verify smoothness

### Task 10: Respect Reduced Motion Preferences
**Acceptance Criteria:** AC5

**Subtasks:**
1. Import `useReducedMotion` hook (created in Story 1.5)
2. Conditionally disable animations when `reducedMotion` is true
3. Replace motion components with plain divs when reduced motion enabled
4. Keep essential transitions (page changes) but simplify them (instant or very quick)
5. Test with OS-level reduced motion setting enabled
6. Ensure app remains usable without animations
7. Document reduced motion behavior in accessibility guide

### Task 11: Create Reusable Animation Utilities
**Acceptance Criteria:** AC2, AC3

**Subtasks:**
1. Create `src/utils/animations.ts` file
2. Export common animation variants:
   - `fadeIn`: `{ initial: { opacity: 0 }, animate: { opacity: 1 } }`
   - `slideUp`: `{ initial: { y: 20, opacity: 0 }, animate: { y: 0, opacity: 1 } }`
   - `scaleIn`: `{ initial: { scale: 0.9, opacity: 0 }, animate: { scale: 1, opacity: 1 } }`
3. Export transition configs: `spring`, `ease`, `duration`
4. Export stagger children config for list animations
5. Document usage examples in comments
6. Use consistent timing across all animations (300ms default)

### Task 12: Create Tests for Animations
**Acceptance Criteria:** AC1-AC9 (verification)

**Subtasks:**
1. Create `src/components/layout/PageTransition.test.tsx`
2. Test: Page transitions apply correct variants
3. Test: Reduced motion disables animations
4. Test: AnimatePresence triggers exit animations
5. Mock `framer-motion` to avoid animation execution in tests
6. Snapshot test for motion component structure
7. Test gesture handlers (swipe-to-delete logic)
8. Verify animations don't break component functionality
9. Achieve 85%+ test coverage (animations can be hard to fully test)

---

## Dev Notes

### Architecture References

**Dependencies:**  
`framer-motion@11.0.3` (Section 3: Tech Stack - Animation Libraries)

**Performance:**  
All animations must use GPU-accelerated properties (Section 12.4: Performance Requirements - 60fps target).

**Accessibility:**  
Respect `prefers-reduced-motion` media query (Section 11.2: Accessibility Standards).

**Coding Standards:**  
Use consistent animation timing (300ms default) and easing functions across app (Section 11: Coding Standards & Conventions).

### Component Structure Example

```tsx
// src/components/layout/PageTransition.tsx
import { motion, AnimatePresence } from 'framer-motion';
import { useReducedMotion } from '@/hooks/useReducedMotion';

const pageVariants = {
  initial: { opacity: 0, y: 20 },
  animate: { opacity: 1, y: 0 },
  exit: { opacity: 0, y: -20 },
};

const pageTransition = {
  duration: 0.3,
  ease: 'easeOut',
};

export const PageTransition: React.FC<{ children: React.ReactNode }> = ({ children }) => {
  const reducedMotion = useReducedMotion();

  if (reducedMotion) {
    return <>{children}</>;
  }

  return (
    <motion.div
      variants={pageVariants}
      initial="initial"
      animate="animate"
      exit="exit"
      transition={pageTransition}
    >
      {children}
    </motion.div>
  );
};
```

### Animation Variants Utility

```typescript
// src/utils/animations.ts
export const fadeIn = {
  initial: { opacity: 0 },
  animate: { opacity: 1 },
  exit: { opacity: 0 },
};

export const slideUp = {
  initial: { y: 20, opacity: 0 },
  animate: { y: 0, opacity: 1 },
  exit: { y: -20, opacity: 0 },
};

export const scaleIn = {
  initial: { scale: 0.9, opacity: 0 },
  animate: { scale: 1, opacity: 1 },
  exit: { scale: 0.9, opacity: 0 },
};

export const staggerChildren = {
  animate: {
    transition: {
      staggerChildren: 0.1,
    },
  },
};

export const springTransition = {
  type: 'spring',
  stiffness: 400,
  damping: 17,
};

export const easeTransition = {
  duration: 0.3,
  ease: 'easeOut',
};
```

### Button Component Example

```tsx
// src/components/ui/Button.tsx
import { motion } from 'framer-motion';
import { useReducedMotion } from '@/hooks/useReducedMotion';

interface ButtonProps {
  children: React.ReactNode;
  onClick?: () => void;
  variant?: 'primary' | 'secondary';
}

export const Button: React.FC<ButtonProps> = ({ children, onClick, variant = 'primary' }) => {
  const reducedMotion = useReducedMotion();

  const baseClasses = 'px-6 py-3 rounded-lg font-semibold focus:outline-none focus:ring-2';
  const variantClasses = variant === 'primary' 
    ? 'bg-blue-500 text-white hover:bg-blue-600 focus:ring-blue-300' 
    : 'bg-gray-200 text-gray-800 hover:bg-gray-300 focus:ring-gray-400';

  if (reducedMotion) {
    return (
      <button className={`${baseClasses} ${variantClasses}`} onClick={onClick}>
        {children}
      </button>
    );
  }

  return (
    <motion.button
      className={`${baseClasses} ${variantClasses}`}
      whileHover={{ scale: 1.05 }}
      whileTap={{ scale: 0.95 }}
      transition={{ type: 'spring', stiffness: 400, damping: 17 }}
      onClick={onClick}
    >
      {children}
    </motion.button>
  );
};
```

### React Router Integration

```tsx
// src/App.tsx or Router component
import { Routes, Route, useLocation } from 'react-router-dom';
import { AnimatePresence } from 'framer-motion';
import { PageTransition } from '@/components/layout/PageTransition';

export const App = () => {
  const location = useLocation();

  return (
    <AnimatePresence mode="wait">
      <Routes location={location} key={location.pathname}>
        <Route path="/" element={<PageTransition><HomePage /></PageTransition>} />
        <Route path="/forecast" element={<PageTransition><ForecastPage /></PageTransition>} />
        <Route path="/favorites" element={<PageTransition><FavoritesPage /></PageTransition>} />
      </Routes>
    </AnimatePresence>
  );
};
```

### Testing Strategy

**Unit Tests:**
- Test PageTransition applies variants correctly
- Test Button animations trigger on hover/tap
- Test reduced motion disables animations
- Mock Framer Motion to avoid animation execution

**Visual Testing:**
- Manual testing on real devices to verify 60fps
- Chrome DevTools Performance panel to measure frame rate
- Test on low-end Android device to ensure smooth performance

**Accessibility Testing:**
- Enable reduced motion in OS settings, verify animations disabled
- Test keyboard navigation with focus states
- Verify screen readers don't announce animation states

### Performance Optimization

**Best Practices:**
1. Only animate `transform` and `opacity` (GPU-accelerated)
2. Avoid animating `width`, `height`, `margin`, `padding` (causes reflow)
3. Use `layout` prop sparingly (expensive for complex layouts)
4. Add `will-change: transform` for complex animations
5. Keep animation duration < 400ms for snappy feel
6. Use `type: 'spring'` for natural, physics-based motion
7. Test on real devices, not just desktop browsers

**Performance Targets:**
- All animations at 60fps on iPhone 8 / Pixel 3 equivalent
- Page transitions < 300ms
- No visible jank or stutter

### Animation Timing Standards

Consistent timing across app for cohesive feel:

- **Micro-interactions (hover, tap):** 150ms
- **Page transitions:** 300ms
- **Loading states:** 200ms fade-in
- **Data updates:** 250ms
- **Gesture animations:** 200-300ms depending on drag distance

### Reduced Motion Handling

When `prefers-reduced-motion: reduce` is detected:
1. Disable decorative animations (hover effects, micro-interactions)
2. Keep essential animations but simplify (instant or 100ms)
3. Maintain usability without animations
4. Don't remove all motion—just reduce intensity

---

## Testing

### Test Scenarios

1. **Page Transitions:** Verify smooth transitions between routes
2. **Button Interactions:** Test hover and tap feedback on buttons
3. **Card Animations:** Verify hover lift effect on weather cards
4. **Loading States:** Test fade-in/out of loading skeletons
5. **Data Updates:** Verify smooth animation when weather data changes
6. **Reduced Motion:** Confirm animations disabled with OS setting
7. **Performance:** Measure 60fps on mid-range device with DevTools
8. **Gestures:** Test swipe-to-delete on mobile devices
9. **Accessibility:** Verify focus states and keyboard navigation

### Coverage Requirement
- **Target:** 85%+ line coverage (animations can be hard to test)
- **Tools:** Vitest + React Testing Library
- **Mocking:** Mock Framer Motion components to avoid animation execution

---

## Change Log

| Date | Author | Change |
|------|--------|--------|
| 2025-12-03 | SM (Bob) | Story created from PRD Epic 1, Story 1.6 |

---

## Dev Agent Record

### Implementation Session

**Date Started:** 2025-12-03  
**Date Completed:** 2025-12-03  
**Agent:** James (Dev Agent)  
**Time Spent:** ~30 minutes  

**Notes:**  
- Created animation utilities file with reusable Framer Motion variants (fadeIn, slideUp, slideDown, scaleIn, staggerContainer, buttonHover, cardHover, pageTransition)
- Created useReducedMotion hook to respect user's accessibility preferences
- Created PageTransition component for smooth route transitions
- Updated App.tsx to use PageTransition with AnimatePresence
- Updated FavoriteButton with reduced motion support and animation utilities
- Updated ForecastDayCard with reduced motion support and stagger animations
- Updated ForecastDisplay with stagger container
- Updated CitySearch with reduced motion support
- All components respect prefers-reduced-motion setting
- All touch targets meet 44×44px accessibility standard (min-h-11, min-w-11)
- Animations use GPU-accelerated properties (transform, opacity)
- Consistent timing across app (300ms transitions, spring animations for interactions)

---

## QA Results

**Tested By:** _Pending_  
**Test Date:** _Pending_  
**Status:** _Pending_  

**Test Results:**  
_QA validation results will be added after implementation._
